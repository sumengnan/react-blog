(window["webpackJsonpreact-blog"]=window["webpackJsonpreact-blog"]||[]).push([[9],{681:function(e,t,a){"use strict";var n=a(32),r=a.n(n),c=a(682),i=a.n(c);r.a.extend(i.a),t.a=r.a},682:function(e,t,a){e.exports=function(){"use strict";return function(e,t,a){e=e||{};var n=t.prototype,r={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function c(e,t,a,r){return n.fromToBase(e,t,a,r)}a.en.relativeTime=r,n.fromToBase=function(t,n,c,i,l){for(var o,s,m,u=c.$locale().relativeTime||r,d=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],f=d.length,p=0;p<f;p+=1){var h=d[p];h.d&&(o=i?a(t).diff(c,h.d,!0):c.diff(t,h.d,!0));var E=(e.rounding||Math.round)(Math.abs(o));if(m=o>0,E<=h.r||!h.r){E<=1&&p>0&&(h=d[p-1]);var y=u[h.l];l&&(E=l(""+E)),s="string"==typeof y?y.replace("%d",E):y(E,n,h.l,m);break}}if(n)return s;var g=m?u.future:u.past;return"function"==typeof g?g(s):g.replace("%s",s)},n.to=function(e,t){return c(e,t,this,!0)},n.from=function(e,t){return c(e,t,this)};var i=function(e){return e.$u?a.utc():a()};n.toNow=function(e){return this.to(i(this),e)},n.fromNow=function(e){return this.from(i(this),e)}}}()},685:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(22),r=a(0);function c(){var e=Object(r.useState)(!1),t=Object(n.a)(e,2),a=t[0],c=t[1];return[a,function(e){if(e instanceof Promise)return new Promise((function(t,a){c(!0),e.then((function(e){t(e),c(!1)})).catch((function(e){a(e),c(!1)}))}))}]}},686:function(e,t,a){"use strict";a(62);var n=a(3),r=(a(158),a(66)),c=(a(206),a(85)),i=a(0),l=a.n(i),o=a(16),s=a(30),m=a(65);function u(e,t){var a=t.find((function(t){return t.name===e}));return a?a.color:""}t.a=Object(o.withRouter)((function(e){var t=Object(s.useSelector)((function(e){return e.article.tagList})),a=e.tagList,i=e.categoryList;return l.a.createElement(l.a.Fragment,null,a.length>0&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.a,{type:"vertical",style:{marginRight:7}}),l.a.createElement(m.a,{type:"icontags",style:{marginRight:7}}),a.map((function(e,a){return l.a.createElement(r.a,{key:a,color:u(e.name,t)},l.a.createElement(o.Link,{to:"/tags/".concat(e.name)},e.name))}))),i.length>0&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.a,{type:"vertical",style:{marginRight:7}}),l.a.createElement(n.a,{type:"folder",style:{marginRight:7}}),i.map((function(e,t){return l.a.createElement(r.a,{key:t,color:"#2db7f5"},l.a.createElement(o.Link,{to:"/categories/".concat(e.name)},e.name))}))))}))},687:function(e,t,a){},692:function(e,t,a){"use strict";a(660);var n=a(662),r=(a(206),a(85)),c=(a(108),a(61)),i=(a(207),a(70)),l=(a(86),a(21)),o=a(22),s=(a(84),a(28)),m=(a(62),a(3)),u=(a(348),a(125)),d=(a(107),a(52)),f=a(0),p=a.n(f),h=(a(687),a(30)),E=(a(42),a(45)),y=a(40),g=a(78),v=a(685),b=(a(65),a(122),a(43)),I=(a(661),a(663)),O=a(124),j=a(681),L=a(209),k=d.a.TextArea;function C(e){var t=e.children,a=e.item,r=e.userInfo,c=e.articleId,l=e.commentId,u=e.replyId,d=e.replyVisible,h=a.user,g=Object(f.useState)(""),v=Object(o.a)(g,2),C=v[0],N=v[1];function w(){if(!r.userId)return i.a.warn("\u60a8\u672a\u767b\u9646\uff0c\u8bf7\u767b\u5f55\u540e\u518d\u8bd5\u3002");E.a.post("/discuss",{userId:r.userId,articleId:c,content:C.trim(),commentId:l}).then((function(t){e.onReply({commentId:0,replyId:0}),e.setCommentList(t.rows)}))}return Object(f.useEffect)((function(){d&&N("")}),[d]),p.a.createElement(n.a,{actions:[p.a.createElement("span",{onClick:function(){e.onReply({commentId:l,replyId:u})}},"Reply to"),p.a.createElement(p.a.Fragment,null,1===r.role&&p.a.createElement(I.a,{title:"\u662f\u5426\u5220\u9664\u8be5\u7559\u8a00\uff1f",cancelText:"\u53d6\u6d88",okText:"\u786e\u8ba4",onConfirm:function(){u?E.a.delete("/discuss/reply/".concat(u)).then((function(){var t=Object(O.a)(e.commentList),a=t.find((function(e){return e.id===l}));a.replies=a.replies.filter((function(e){return e.id!==u})),e.setCommentList(t)})):E.a.delete("/discuss/comment/".concat(l)).then((function(){var t=Object(O.a)(e.commentList);t=t.filter((function(e){return e.id!==l})),e.setCommentList(t)}))}},p.a.createElement(m.a,{type:"delete",className:"icon-delete"})))],author:p.a.createElement("span",null,h&&h.username),avatar:p.a.createElement(L.a,{userInfo:h}),content:p.a.createElement("div",{className:"article-detail",dangerouslySetInnerHTML:{__html:Object(y.g)(a.content,!0)}}),datetime:p.a.createElement(b.a,{title:a.createdAt},p.a.createElement("span",null,Object(j.a)(a.createdAt).fromNow()))},d&&p.a.createElement("div",{className:"reply-form"},p.a.createElement(k,{placeholder:"\u56de\u590d".concat(a.user.username,"..."),value:C,onChange:function(e){N(e.target.value)},onKeyUp:function(e){e.ctrlKey&&13===e.keyCode&&w()}}),p.a.createElement("div",{className:"reply-form-controls"},p.a.createElement("span",{className:"tip"},"Ctrl or \u2318 + Enter"),p.a.createElement(s.a,{htmlType:"submit",type:"primary",disabled:!C.trim(),onClick:w},"\u56de\u590d"))),t)}var N=function(e){var t=Object(h.useSelector)((function(e){return e.user})),a=e.commentList,n=e.articleId,r=Object(f.useState)({commentId:0,replyId:0}),c=Object(o.a)(r,2),i=c[0],l=c[1];return p.a.createElement("div",{className:"discuss-list"},a.map((function(a){return p.a.createElement(C,{item:a,key:a.id,articleId:n,userInfo:t,commentId:a.id,setCommentList:e.setCommentList,commentList:e.commentList,onReply:l,replyVisible:i.commentId===a.id&&!i.replyId},a.replies.map((function(r){return p.a.createElement(C,{item:r,key:r.id,articleId:n,userInfo:t,commentId:a.id,replyId:r.id,setCommentList:e.setCommentList,commentList:e.commentList,onReply:l,replyVisible:i.commentId===a.id&&i.replyId===r.id})})))})))},w=a(60),S=d.a.TextArea,x=function(e){var t=e.onChange,a=e.onSubmit,n=e.submitting,r=e.value,c=e.articleId;return p.a.createElement("div",null,p.a.createElement(u.a.Item,null,p.a.createElement(S,{rows:4,placeholder:"\u8bf4\u70b9\u4ec0\u4e48...",onChange:t,value:r})),p.a.createElement(u.a.Item,null,p.a.createElement("div",{className:"controls"},p.a.createElement(m.a,{type:"info-circle",className:"controls-tip-icon"}),p.a.createElement("span",{className:"controls-tip"},"\u652f\u6301 Markdown \u8bed\u6cd5"),p.a.createElement(s.a,{className:"disscus-btn",htmlType:"submit",loading:n,onClick:a,type:"primary"},-1!==c?"\u6dfb\u52a0\u8bc4\u8bba":"\u7559\u8a00"))))};t.a=function(e){var t=Object(h.useDispatch)(),a=Object(w.b)(),s=Object(h.useSelector)((function(e){return e.user})),u=s.username,d=(s.role,e.commentList),b=e.articleId,I=Object(f.useState)(""),O=Object(o.a)(I,2),j=O[0],k=O[1],C=Object(v.a)(),S=Object(o.a)(C,2),M=S[0],R=S[1];function T(e){switch(e.key){case"login":a.emit("openSignModal","login");break;case"register":a.emit("openSignModal","register");break;case"loginout":t(Object(g.b)())}}return p.a.createElement("div",{id:"discuss"},p.a.createElement("div",{className:"discuss-header"},p.a.createElement("span",{className:"discuss-count"},Object(y.a)(d)),-1!==b?"\u6761\u8bc4\u8bba":"\u6761\u7559\u8a00",p.a.createElement("span",{className:"discuss-user"},p.a.createElement(c.a,{overlay:u?p.a.createElement(l.a,{onClick:T},p.a.createElement(l.a.Item,{key:"loginout"},"\u6ce8\u9500")):p.a.createElement(l.a,{onClick:T},p.a.createElement(l.a.Item,{key:"login"},"\u767b\u5f55"),p.a.createElement(l.a.Item,{key:"register"},"\u6ce8\u518c")),trigger:["click","hover"]},p.a.createElement("span",null,u||"\u672a\u767b\u5f55\u7528\u6237"," ",p.a.createElement(m.a,{type:"down"})))),p.a.createElement(r.a,{className:"hr"})),p.a.createElement(n.a,{avatar:u?p.a.createElement(L.a,{userInfo:s}):p.a.createElement(m.a,{type:"github",theme:"filled",style:{fontSize:40,margin:"5px 5px 0 0"}}),content:p.a.createElement(x,{onChange:function(e){return k(e.target.value)},onSubmit:function(){if(j)return s.username?void R(E.a.post("/discuss",{articleId:e.articleId,content:j,userId:s.userId})).then((function(t){k(""),e.setCommentList(t.rows)})):i.a.warn("\u60a8\u672a\u767b\u9646\uff0c\u8bf7\u767b\u5f55\u540e\u518d\u8bd5\u3002")},submitting:M,value:j,articleId:b})}),p.a.createElement(N,{commentList:d,articleId:b,setCommentList:e.setCommentList}))}},706:function(e,t,a){},738:function(e,t,a){"use strict";a.r(t);a(208);var n=a(123),r=(a(664),a(665)),c=(a(62),a(3)),i=(a(206),a(85)),l=a(26),o=a(22),s=a(0),m=a.n(s),u=(a(706),a(159)),d=a(45),f=a(40),p=a(685),h=a(686),E=a(65),y=(a(677),a(673)),g=y.a.Link;function v(e){var t=[];return e.replace(/<(h[1-6])[\s\S]+?(?=<\/\1>)/g,(function(e,a){var n=e.replace(/.*?>/,""),r=e.indexOf('"'),c=e.indexOf('">'),i="#".concat(e.slice(r+1,c));!function e(t,a){var n=t[t.length-1];n&&n.tag!==a.tag?e(n.children,a):t.push(a)}(t,{tag:a,title:n,href:i,children:[]})})),t}var b=function(e){var t=v(e.content);return m.a.createElement(y.a,{affix:!1},t.map((function e(t){var a=t.href,n=t.title,r=t.children;return m.a.createElement(g,{key:a,href:a,title:n},r.length>0&&r.map((function(t){return e(t)})))})))},I=a(692);t.default=function(e){var t=Object(p.a)(),a=Object(o.a)(t,2),y=a[0],g=a[1],v=Object(s.useState)({title:"",content:"",tags:[],categories:[],comments:[],createdAt:"",viewCount:0}),O=Object(o.a)(v,2),j=O[0],L=O[1],k=Object(s.useState)(!1),C=Object(o.a)(k,2),N=C[0],w=C[1];Object(s.useEffect)((function(){setTimeout((function(){var t=decodeURI(e.location.hash),a=document.querySelector('a[href="'.concat(t,'"]'));a&&t&&a.click()}),800)}),[]),Object(s.useEffect)((function(){g(d.a.get("/article/".concat(e.match.params.id))).then((function(e){e.content=Object(f.g)(e.content),L(e)})).catch((function(t){e.history.push("/404")}))}),[e.match.params.id]);var S=j.title,x=j.content,M=j.tags,R=j.categories,T=j.comments,A=j.createdAt,F=j.viewCount,_=parseInt(e.match.params.id),q=Object(u.useMediaQuery)({query:"(max-width: 1300px)"});return m.a.createElement(n.a,{tip:"Loading...",spinning:y},m.a.createElement("article",{className:"app-article",style:{background:"#fff",paddingLeft:"30px",paddingRight:q?0:275}},m.a.createElement("div",{className:"post-header"},m.a.createElement("h1",{className:"post-title"},S),m.a.createElement("div",{className:"article-desc"},m.a.createElement("span",{className:"post-time"},m.a.createElement(E.a,{type:"iconpost"}),"\xa0 Posted on \xa0",m.a.createElement("span",null,A.slice(0,10))),m.a.createElement(h.a,{tagList:M,categoryList:R}),m.a.createElement(i.a,{type:"vertical"}),m.a.createElement("a",{className:"comment-count",href:"#discuss",style:{color:"inherit"}},m.a.createElement(E.a,{type:"iconcomment"}),m.a.createElement("span",{style:{marginRight:5}}," ",Object(f.a)(T))),m.a.createElement(E.a,{type:"iconview",style:{marginRight:2}}),m.a.createElement("span",null,F))),m.a.createElement("div",{className:"article-detail",dangerouslySetInnerHTML:{__html:x}}),q?m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"drawer-btn",onClick:function(e){return w(!0)}},m.a.createElement(c.a,{type:"menu-o",className:"nav-phone-icon"})),m.a.createElement(r.a,{title:S,placement:"right",closable:!1,onClose:function(e){return w(!1)},visible:N,getContainer:function(){return document.querySelector(".app-article")}},m.a.createElement("div",{className:"right-navigation"},m.a.createElement(b,{content:x})))):m.a.createElement("nav",{className:"article-navigation"},m.a.createElement(b,{content:x})),m.a.createElement(I.a,{articleId:_,commentList:T,setCommentList:function(e){L(Object(l.a)(Object(l.a)({},j),{},{comments:e}))}})))}}}]);